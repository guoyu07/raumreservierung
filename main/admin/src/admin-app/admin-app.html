<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/iron-location/iron-location.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="admin-app">
  <template>
    <style is="custom-style" include="iron-flex iron-positioning iron-flex-alignment">
      :host {
        display: block;
        --primary-color: #3F51B5;
        --accent-color: #FF4081;
        @apply(--layout-fullbleed);
        @apply(--layout-fit);
      }
      paper-drawer-panel {
        --paper-drawer-panel-drawer-container: {
          background-color: #F5F5F5;
        }
      }
      paper-card {
        --paper-card: {
          @apply(--layout-vertical);
          @apply(--layout-center-center);
          width: 80%;
          margin-top: 20px;
          padding-top: 20px;
        };
      }
      paper-tabs {
        --paper-tabs-selection-bar-color: #FFFFFF;
      }
    </style>

    <iron-location id="locator" dwell-time="2" hash="{{hash}}" path="{{path}}"></iron-location>

    <paper-drawer-panel force-narrow disable-edge-swipe disable-swipe id="drawerPanel">

      <div drawer>

        <div style="text-align:center" id="drawerSpinnerWrapper">
          <paper-spinner active id="drawerSpinner" style="margin: 0 auto;text-align:center;padding-top: 10px;"></paper-spinner>
          <p style="color: #757575">Loading content...</p>
        </div>

        <admin-app-drawer-content></admin-app-drawer-content>

      </div>

      <div main>

        <paper-header-panel mode="standard">

          <paper-toolbar class="medium-tall paper-header">
            <paper-icon-button icon="menu" paper-drawer-toggle title="Men&uuml; &ouml;ffnen" alt="Men&uuml; &ouml;ffnen"></paper-icon-button>
            <div class="title" style="padding-bottom: 1px;">Administration</div>
            <a href="https://gymnasium-klotzsche.de/">
              <div class="right"><img src="/raumreservierung/project/img/gykl-logo.gif" width="78px"></div>
            </a>
            <div class="bottom fit">
              <paper-tabs fit-container no-slide selected="{{selectedTab}}" scrollable>
                <paper-tab>Nutzerverwaltung</paper-tab>
                <paper-tab>Raumverwaltung</paper-tab>
                <paper-tab>Fehlermeldungen</paper-tab>
              </paper-tabs>
            </div>
          </paper-toolbar>

          <!-- dynamic fragment-content for admins only -->
          <iron-pages id="pages" selected="{{selectedPage}}">

            <div id="page1" class="layout vertical center">
              <paper-card>
                <paper-spinner active></paper-spinner>
                <p style="color: #757575;">Loading Usermanager...<br></p>
              </paper-card>
              <admin-nutzerverwaltung id="nutzerverwaltung-origin"></admin-nutzerverwaltung>
            </div>
            <div id="page2" class="layout vertical center">
              <paper-card>
                <paper-spinner active></paper-spinner>
                <p style="color: #757575;">Loading Roommanager...<br></p>
              </paper-card>
            </div>
            <div id="page3" class="layout vertical center">
              <paper-card>
                <paper-spinner active></paper-spinner>
                <p style="color: #757575;">Loading Error-Messages...<br></p>
              </paper-card>
            </div>

          </iron-pages>

        </paper-header-panel>

      </div>

    </paper-drawer-panel>

  </template>

  <script>
    Polymer({

      is: 'admin-app',

      properties: {
          hash: {
              type: String,
              observer: '_onHashChange'
          },
          path: {
              type: String,
              observer: '_onPathChange'
          },
          selectedTab: {
              type: Number,
              value: 1,
              observer: '_onTabChanged'
          },
          selectedPage: {
              type: Number,
              value: 1,
              observer: '_onPageChanged'
          }
      },

      listeners: {
          'push':'pushConsoleLog',
          'drawerPanel.iron-select':'_onPanelSelect',
          'pageLoaded':'_onPageLoad'
      },

        ready: function() {
          this.fire('push', 'element loaded');
          this.hash = this.$.locator.hash;
          // Initial Trigger for predefined selected
          this._onPageChanged();
        },

        pushConsoleLog: function(e) {
          console.log("[admin-app] "+e.detail);
        },

        _onHashChange: function(){
          var loc = this.$.locator;
        },
        _onPanelSelect: function(){
            var sel = this.$.drawerPanel.selected;
            if(sel == "drawer") {
                this.importHref('src/admin-app-drawer-content/admin-app-drawer-content.html', this._onDrawerLoad, null, true);
            }
        },
        _onDrawerLoad: function(){
            this.$.drawerSpinner.active = false;
            this.$.drawerSpinnerWrapper.style.display = "none";
        },
        _onPathChange: function(){
            if (this.path.includes('logout')) {
                window.location = '/raumreservierung/project/main/logout';
            }
        },
        _onTabChanged: function(){
            this.selectedPage = this.selectedTab;
        },
        _onPageChanged: function(){
            this.selectedTab = this.selectedPage;
            switch (this.selectedTab) {
                case 0:
                    this.importHref('src/admin-nutzerverwaltung/admin-nutzerverwaltung.html', null, this._onPageLoadError, true);
                    break;
                case 1:

                    break;
                case 2:

                    break;
            }
        },
        _onPageLoad: function() {
            switch (this.selectedPage) {
                case 0:
                    this.$.page1.querySelector('paper-card').style.display = "none";
                    break;
                case 1:
                    this.$.page2.querySelector('paper-card').style.display = "none";
                    break;
                case 2:
                    this.$.page3.querySelector('paper-card').style.display = "none";
            }
        }

    });
  </script>
</dom-module>
