<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<dom-module id="raumreservierung-main">
  <template>
    <style>
      :host {
        display: block;
        margin: 0 auto;
        --primary-color: #8BC34A;
        --accent-color: #607D8B;
        color: #212121;
      }
      #loadIndicator {
        @apply(--layout-center-center);
        margin: 0 auto;
        text-align: center;
      }
      #errorbox {
        --paper-card: {
          @apply(--layout-vertical);
          @apply(--layout-flex);
        }
      }
      .navHeader {
        color: #212121;
        font-size: 22px;
        margin: 0 auto;
        text-align: center;
        padding: 5px 0;
        width: auto;
        text-decoration: none;
      }
    </style>

    <iron-ajax id="mainRequest"
               url="../backend/api/main-ajax.php"
               method="POST"
               body=""
               content-type="application/x-www-form-urlencoded"
               handle-as="json"
               timeout="5000"
               debounce-duration="300"
               last-response="{{response}}"></iron-ajax>

    <paper-dialog id="loadIndicator" with-backdrop no-cancel-on-esc-key no-cancel-on-outside-click>
      <h2>L&auml;dt, bitte warten...</h2>
      <paper-spinner active></paper-spinner>
    </paper-dialog>
    <paper-card id="errorbox"></paper-card>

    <template is="dom-if" if="{{!loggedin}}">

      <paper-drawer-panel disable-edge-swipe disable-swipe>

        <div drawer>
          <paper-toolbar style="background-color: #F5F5F5; border-bottom: 1px solid #E0E0E0;">
            <paper-icon-button icon="arrow-back" paper-drawer-toggle style="color: #212121;"></paper-icon-button>
            <div class="title navHeader">Navigation</div>
          </paper-toolbar>
        </div>

        <paper-header-panel mode="waterfall" main>
          <paper-toolbar style="color: #212121;">
            <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
            <div class="title" style="padding-bottom: 1px;">Raumreservierung</div>
            <a href="https://www.gymnasium-klotzsche.de" target="_blank">
              <img src="../../img/gykllogoColored.png" width="70px" class="right" title="Gymnasium Dresden-Klotzsche">
            </a>
          </paper-toolbar>
        </paper-header-panel>

      </paper-drawer-panel>

    </template>

  </template>

  <script>
    Polymer({

        is: 'raumreservierung-main',

        properties: {
            response: Object,
            loggedin: {
                type: Boolean,
                value: false
            }
        },

        listeners: {
            'mainRequest.request':'_onRequest',
            'mainRequest.response':'_onResponse',
            'mainRequest.error':'_onError'
        },

        ready: function() {
            console.log('[raumreservierung-main] element loaded and ready');
        },
        _onRequest: function() {
            this.$.loadIndicator.center();
            this.$.loadIndicator.open();
        },
        _onResponse: function() {
            this.$.loadIndicator.close();
        },
        _onError: function() {
            this.$.loadIndicator.close();
        }

    });
  </script>
</dom-module>
